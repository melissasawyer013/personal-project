code for index.ejs at top of first div
<% if ((!user) || (user === undefined)) {
                console.log('user not signed in');
            } else { %>
                <p>Hello, <%= user.formFirstName %>. </p>
            <% } %>





const fetch = require()



router.get('/experimentalSearchStuff.ejs', async(req, res) => {
    let formDataSearchObject = await req.query;
    let searchNeighborhood = await formDataSearchObject['searchNeighborhood']; //The neighborhood(s) the user selects with checkbox to search
    let searchNeeds = await formDataSearchObject['searchNeeds']; //The need(s) the user selects with checkbox to search
    let searchOffers = await formDataSearchObject['searchOffers']; //The offer(s) the user selects with checkbox to search
    let searchesArray = await []; ///searchesArray should equal [[searchNeighborhood results], [searchNeeds results], [searchOffers results]]
    let needMatches = await [];
    let offerMatches = await [];
    await console.log('Step 1: the variables are set')
    const compileSearchResults = async () => {
        await console.log('Step 2: The compileSearchResults function has initiated')
        if (searchNeighborhood != undefined) {
            //If only one neighborhood checkbox is selected, the data is not stored as an array. This makes it into an array for storage in the searchesArray variable
            if (Array.isArray(searchNeighborhood) === false) {
                searchNeighborhood = await [searchNeighborhood];
            };
            await searchesArray.push(searchNeighborhood);
            await console.log('Step 3: the Neighborhood checkboxes have been pushed to the searchesArray')
        };
        if (searchNeeds != undefined) {
            //If only one need checkbox is selected, the data is not stored as an array. This makes it into an array for storage in the searchesArray variable
            if (Array.isArray(searchNeeds) === false) {
                searchNeeds = await [searchNeeds];
            };
            await searchesArray.push(searchNeeds);
            await console.log('Step 4: the needs checkboxes have been pushed to the searchesArray')
            await searchesArray[1].forEach(async function(need){
                await dbHandler.collection(collectionUserForm)
                .find({formNeeds: need}) 
                .project({'publicDisplayName': 1, 'publicDisplayContact': 1, 'publicDisplayAddress': 1,})
                .toArray((error, result) => {
                    if (error) {
                        console.log(error)
                    } else {
                        needMatches.push(result);
                        console.log('Step 5: the elements in searchesArray[1] have been looped through, the collection has been searched based on the element in searchesArray[1], and the matches have been pushed to the variable needMatches. Content in needMatches is:')
                        console.log(needMatches);
                    }
                })
            });
        };
        if (searchOffers != undefined) {
            //If only one offer checkbox is selected, the data is not stored as an array. This makes it into an array for storage in the searchesArray variable
            if (Array.isArray(searchOffers) === false) {
                searchOffers = await [searchOffers];
            };
            await searchesArray.push(searchOffers);
            await console.log('Step 6: the offers checkboxes have been pushed to the searchesArray')
            await searchesArray[2].forEach(async function(offer){
                await dbHandler.collection(collectionUserForm)
                .find({formOfferings: offer})
                .project({'publicDisplayName': 1, 'publicDisplayContact': 1, 'publicDisplayAddress': 1,})
                .toArray((error, result) => {
                    if (error) {
                        console.log(error);
                    } else {
                        offerMatches.push(result);
                        console.log('Step 7: the elements in searchesArray[2] have been looped through, the collection has been searched based on the element in searchesArray[2], and the matches have been pushed to the variable offerMatches. Content in offerMatches is:')
                        console.log(offerMatches);
                    }
                })
            }) 
        };
        await console.log('completed the compileSearchParameters function');
        // await console.log(searchesArray[0]);
        // await console.log(searchesArray[1]);
        // await console.log(searchesArray[2]);
        await renderPage();
    }
    
   

    const renderPage = async () => { 
        await console.log('Step 8: The renderPage function has initiated');
        await res.render('pages/experimentalSearchStuff.ejs', {
            'offerMatches': offerMatches || [],
            'needMatches': needMatches || [],
            'offer': searchesArray[2] || [],
            'need': searchesArray[1] || [],
        });
        await console.log('Step 9: The page has been rendered with the variable availble to the EJS file: offerMatches, needMatches, offer, need');
        // await needMatches.forEach(async(element)=> {
        //     await console.log('the element is');
        //     await console.log(element);
        // });
        // await console.log('the needMatches is: ');
        // await console.log(needMatches);
        // await console.log('the offerMatches is: ');
        // await console.log(offerMatches);
        // await console.log('the offer is: ');
        // await console.log(searchesArray[2]);
        // await console.log('the need is: ');
        // await console.log(searchesArray[1]);
        await console.log('Step 10: completed renderPage function')
    }
    

    await compileSearchResults();
    await console.log('the get route is now finished running')
    // await console.log(searchesArray)

}) //end of experimental route     
     
     
     
     
     
     <% allMatches.forEach( (singleMatch) => { %>
            <%= singleMatch.PARAMETER %> <br>
            <div class="medium-content-container-column palette-c" style="font-size: 1em;">
                <h2>Need or Offering (Example)</h2>
                <div class="container-row-no-wrap">
                    <div class="search-result-row-label">
                        <span>Neighbor's Name:</span>
                    </div>   
                    <div class="search-result-row-result">
                        <span> <%= singleMatch.formFirstName %> </span>
                        <br><br>
                    </div>
                </div>
            </div>
        <% }) %> 











        <% searchMatchArray.forEach ((singleMatchedUser) => { %>
            
                <div class="medium-content-container-column palette-c" style="font-size: 1em;">
                    
                    <h2> <%= offer %> </h2>
                    <div class="container-row-no-wrap">
                        <div class="search-result-row-label">
                            <span>Neighbor's Name:</span>
                        </div>   
                        <div class="search-result-row-result">
                            <span> <%= singleMatchedUser.publicDisplayName %> </span>
                            <br><br>
                        </div>
                    </div>
                    <div class="container-row-no-wrap">
                        <div class="search-result-row-label">
                            <span>Neighborhood:</span>
                        </div>   
                        <div class="search-result-row-result">
                            <span> <%= singleMatchedUser.formNeighborhood %> </span>
                            <br><br>
                        </div>
                    </div>
                    <div class="container-row-no-wrap">
                        <div class="search-result-row-label">
                            <span>More Information from Neighbor:</span>
                        </div>   
                        <div class="search-result-row-result">
                            
                            <!-- need to do some Looping here to get the correct explainOffer -->
                            <span> <%= singleMatchedUser.explainOfferCooking %> </span>
                            <br><br>
                        </div>
                    </div>
                    <div class="container-row-no-wrap">
                        <div class="search-result-row-label">
                            <span>Contact Information:</span>
                        </div>   
                        <div class="search-result-row-result">
                            <span> <%= singleMatchedUser.publicDisplayContact %> </span><br>
                            
                            <br><br>
                        </div>
                    </div>
                    <div class="container-row-no-wrap">
                        <div class="search-result-row-label">
                            <span>Community Update:</span>
                        </div>   
                        <div class="search-result-row-result">
                            <span> <%= singleMatchedUser.communityUpdateOfferCooking %> </span>
                            <br><br>
                        </div>
                    </div>
                    <form action="/addCommunityNotes" method="PUT">
                        <fieldset>
                            <div class="container-row-no-wrap">
                                <div class="search-result-row-label">
                                    <legend>Update this need or offering:</legend>
                                    <label for="communityNotes">Examples: Explain how this need was met and on what date or explain how this offering was accessed and on what date.</label>
                                </div>   
                                <div class="search-result-row-result">
                                    <textarea class="search-result-textarea" placeholder="Explain here" id="communityNotes" name="communityNotes"> <%= singleMatchedUser.communityUpdateOfferCooking %> </textarea>
                                    <br><br>
                                    <input type="submit" class="button palette-a">
                                    <br>
                                </div>
                            </div>
                        </fieldset>  
                    </form>  
                </div>  
                
                
                <% }) %></div>




























                <% let explainOffer = ''; %>
                <% let communityUpdate = '' %>
                <% if (offer = 'Offer: Childcare') { %>
                    <% explainOffer = singleMatchedUser.explainOfferChildcare; %>  
                    <% communityUpdate = singleMatchedUser.communityUpdateOfferChildcare %> 
                <% } else if (offer = 'Offer: Cooking') { %>
                    <% explainOffer = singleMatchedUser.explainOfferCooking; %>  
                    <% communityUpdate = singleMatchedUser.communityUpdateOfferCooking %> 
                <% } else if (offer = 'Offer: Food and Supplies') { %>
                    <% explainOffer = singleMatchedUser.explainOfferFoodAndSupplies; %>  
                    <% communityUpdate = singleMatchedUser.communityUpdateOfferFoodAndSupplies %>
                    <div class="medium-content-container-column palette-c" style="font-size: 1em;">
                        
                        <h2> <%= offer %> </h2>
                        <div class="container-row-no-wrap">
                            <div class="search-result-row-label">
                                <span>Neighbor's Name:</span>
                            </div>   
                            <div class="search-result-row-result">
                                <span> <%= singleMatchedUser.publicDisplayName %> </span>
                                <br><br>
                            </div>
                        </div>
                        <div class="container-row-no-wrap">
                            <div class="search-result-row-label">
                                <span>Neighborhood:</span>
                            </div>   
                            <div class="search-result-row-result">
                                <span> <%= singleMatchedUser.formNeighborhood %> </span>
                                <br><br>
                            </div>
                        </div>
                        <div class="container-row-no-wrap">
                            <div class="search-result-row-label">
                                <span>More Information from Neighbor:</span>
                            </div>   
                            <div class="search-result-row-result">
                                
                                <!-- need to do some Looping here to get the correct explainOffer -->
                                <span> <%= explainOffer %> </span>
                                <br><br>
                            </div>
                        </div>
                        <div class="container-row-no-wrap">
                            <div class="search-result-row-label">
                                <span>Contact Information:</span>
                            </div>   
                            <div class="search-result-row-result">
                                <span> <%= singleMatchedUser.publicDisplayContact %> </span><br>
                                
                                <br><br>
                            </div>
                        </div>
                        <div class="container-row-no-wrap">
                            <div class="search-result-row-label">
                                <span>Community Update:</span>
                            </div>   
                            <div class="search-result-row-result">
                                <span> <%= communityUpdate %> </span>
                                <br><br>
                            </div>
                        </div>
                        <form action="/addCommunityNotes" method="PUT">
                            <fieldset>
                                <div class="container-row-no-wrap">
                                    <div class="search-result-row-label">
                                        <legend>Update this need or offering:</legend>
                                        <label for="communityNotes">Examples: Explain how this need was met and on what date or explain how this offering was accessed and on what date.</label>
                                    </div>   
                                    <div class="search-result-row-result">
                                        <textarea class="search-result-textarea" placeholder="Explain here" id="communityNotes" name="communityNotes"> <%= communityUpdate %> </textarea>
                                        <br><br>
                                        <input type="submit" class="button palette-a">
                                        <br>
                                    </div>
                                </div>
                            </fieldset>  
                        </form>  
                    </div>  
















        <!-- <div class="medium-content-container-column palette-c" style="font-size: 1em;">
            <h2>Need or Offering (Example)</h2>
            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>Neighbor's Name:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>Neighbor 4</span>
                    <br><br>
                </div>
            </div>
            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>Category:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>childcare</span>
                    <br><br>
                </div>
            </div>
            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>Neighborhood:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>Codman</span>
                    <br><br>
                </div>
            </div>
            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>More Information from Neighbor:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>I am looking for childcare outside of my home on the days my partner and I both work (usually only 1-2 afternoons per week). We have an outgoing 2-year-old who plays well with children. Please send references if you respond to this request.</span>
                    <br><br>
                </div>
            </div>
            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>Frequency:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>weekly, varying schedule</span>
                    <br><br>
                </div>
            </div>
            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>Contact Information:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>thisperson@email.com</span><br>
                    <span>(720) 894-2076</span><br>
                    <span>Street Name</span>
                    <br><br>
                </div>
            </div>
            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>Community Update:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>This is where information that is updated on the form below gets put. </span>
                    <br><br>
                </div>
            </div>
            <form action="/addCommunityNotes" method="POST">
                <fieldset>
                    <div class="container-row-no-wrap">
                        <div class="search-result-row-label">
                            <legend>Update this need or offering:</legend>
                            <label for="communityNotes">Examples: Explain how this need was met and on what date or explain how this offering was accessed and on what date.</label>
                        </div>   
                        <div class="search-result-row-result">
                            <textarea class="search-result-textarea" placeholder="Explain here" id="communityNotes" name="communityNotes"></textarea>
                            <br><br>
                            <input type="submit" class="button palette-a">
                            <br>
                        </div>
                    </div>
                </fieldset>  
            </form>
        </div> -->

       
        
        

        <!-- <div class="medium-content-container-column palette-c" style="font-size: 1em;">
            <h2>Need or Offering (Example)</h2>
            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>Neighbor's Name:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>Neighbor 4</span>
                    <br><br>
                </div>
            </div>
            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>Category:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>childcare</span>
                    <br><br>
                </div>
            </div>
            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>Neighborhood:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>Codman</span>
                    <br><br>
                </div>
            </div>
            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>More Information from Neighbor:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>I am looking for childcare outside of my home on the days my partner and I both work (usually only 1-2 afternoons per week). We have an outgoing 2-year-old who plays well with children. Please send references if you respond to this request.</span>
                    <br><br>
                </div>
            </div>
            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>Frequency:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>weekly, varying schedule</span>
                    <br><br>
                </div>
            </div>
            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>Contact Information:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>thisperson@email.com</span><br>
                    <span>(720) 894-2076</span><br>
                    <span>Street Name</span>
                    <br><br>
                </div>
            </div>


            <div class="container-row-no-wrap">
                <div class="search-result-row-label">
                    <span>Community Update:</span>
                </div>   
                <div class="search-result-row-result">
                    <span>This is where information that is updated on the form below gets put. </span>
                    <br><br>
                </div>
            </div>
            <form action="/addCommunityNotes" method="POST">
                <fieldset>
                    <div class="container-row-no-wrap">
                        <div class="search-result-row-label">
                            <legend>Update this need or offering:</legend>
                            <label for="communityNotes">Examples: Explain how this need was met and on what date or explain how this offering was accessed and on what date.</label>
                        </div>   
                        <div class="search-result-row-result">
                            <textarea class="search-result-textarea" placeholder="Explain here" id="communityNotes" name="communityNotes"></textarea>
                            <br><br>
                            <input type="submit" class="button palette-a">
                            <br>
                        </div>
                    </div>
                </fieldset>  
            </form>
        </div> -->



// working for redirect to update-form with form data accessible through user
router.use(session({
    secret: 'codesquad',
    cookie: {
        maxAge: 1000 * 60 * 60 * 24 * 7
    },
    store: new MongoStore({
        url: dbURL
    }),
    resave: false,
    saveUninitialized: false,
    cookie: {secure: false}
    
}));
router.use(flash());
router.use(passport.initialize());
router.use(passport.session());


// working for redirect to update-form with form data accessible through user
passport.use(new LocalStrategy({username: 'username'}, (username, password, done) => {
    dbHandler.collection(collectionUserForm).find({username: username}).toArray((err, user) => {
        let userObject = user[0];
        if(err) {
            console.log(`there was an error`);
            return err;
        }
        bcrypt.compare(password, userObject.password, (err, isMatch) => {
            if(err) return done(err, null);
            if (isMatch) return done(null, userObject);

             
                console.log('passwords do not match')
                return done(null, false);
            
        });
    })
}
));

// working for redirect to update-form with form data accessible through user
passport.serializeUser((user, done) => {
    console.log(`user ${user} serialized`);
    done(null, user);
});
passport.deserializeUser((username, done) => {
    done(null, {username: username});
})




//logout handle
router.get('/logout', (req, res) => {
    req.logout();
    req.flash('success_msg', 'You are logged out');
    res.redirect('login')
});

// working for redirect to update-form with form data accessible through user
router.post('/sendLogin', 
    passport.authenticate('local'), 
    (req, res, next) => {
        console.log('is the user authenticated')
        console.log(req.isAuthenticated())
        res.render('pages/update-form', {
            'user': req.user,
        })
    }
    
);

// working for redirect to update-form with form data accessible through user
router.get('/update-form', ensure.ensureLoggedIn(),
(req, res) => {
    dbHandler.collection(collectionUserForm).findOne({username: req.user.username}).toArray((err, user) => {
        if(err) return console.log(err)
        let userObject = user[0]
        console.log(userObject)
        if(user) res.render('pages/update-form', {user: userObject})
    })
});